# ⚡ 角色变量快速开始指南

## 什么是角色变量？

当Firebase中的剧本使用了 **`{{角色A}}`**、**`{{角色B}}`** 这样的变量时，你就可以为每个变量选择不同的AI角色。系统会自动替换整个故事中的这些变量。

## 示例

### Firebase 中的剧本
```
剧本名: "神秘的邂逅"

角色A: {{角色A}}
角色B: {{角色B}}

故事背景: 你在{{角色A}}和{{角色B}}的陪伴下走进了一个古老的城堡...
```

### 用户操作
1. 点击"开始游玩"
2. 系统显示：
   ```
   🎭 请为以下角色变量分配AI角色：
   
   [角色A] ▼ 选择...  →选中张三 ✓
   [角色B] ▼ 选择...  →选中李四 ✓
   ```
3. 点击"开始游戏"

### 游戏中的结果
```
故事背景: 你在张三和李四的陪伴下走进了一个古老的城堡...
```

## 一句话总结

**🎭 写一个剧本，用 {{角色A}}、{{角色B}} 等变量；用户选择具体的AI角色；系统自动替换所有出现的变量。**

## 使用要点

✅ **变量格式** - `{{角色A}}`、`{{角色B}}`、`{{角色0}}`、`{{角色1}}` 等

✅ **支持位置** - 角色名、角色简介、故事背景、选择点、提示选项等所有文本字段

✅ **自动替换** - 系统提示、用户提示、故事内容、选择选项都会自动替换

✅ **独立选择** - 为每个变量独立选择AI角色，同一变量只需选一次

⚠️ **必须选择** - 所有检测到的变量都必须被分配AI角色

---

## 📋 完整流程图

```
┌─────────────────────────────────────┐
│  1. 打开剧本                        │
│     （包含 {{角色A}}、{{角色B}}）   │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  2. 系统自动检测角色变量            │
│     找到: {{角色A}}、{{角色B}}      │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  3. 显示变量选择界面                │
│     ☐ 角色A - 选择AI角色           │
│     ☐ 角色B - 选择AI角色           │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  4. 用户为每个变量选择AI角色        │
│     ✓ 角色A → 张三                 │
│     ✓ 角色B → 李四                 │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  5. 点击"开始游戏"                  │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  6. 后端处理：替换所有变量          │
│     {{角色A}} → 张三                │
│     {{角色B}} → 李四                │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  7. 进入角色初始化界面              │
│     （所有文本都已替换）            │
└──────────────┬──────────────────────┘
               ↓
┌─────────────────────────────────────┐
│  8. 选择策略，进入对话              │
│     （AI模型接收已替换的内容）      │
└─────────────────────────────────────┘
```

## 常见场景

### 场景 1: 两个AI角色的互动
```
Firebase: "{{角色A}}建议{{角色B}}应该..."
用户选: 角色A=张三, 角色B=李四
结果:  "张三建议李四应该..."
```

### 场景 2: 多人剧本中的角色互动
```
Firebase:
- 角色1: {{角色A}}
- 角色2: {{角色B}}
- 角色3: {{角色C}}
用户选: 各自选择
结果: 3个变量都被替换
```

### 场景 3: 重复出现的变量
```
Firebase:
- "{{角色A}}走进房间"
- "{{角色A}}看到了..."
- "{{角色A}}决定..."
用户选: 角色A=张三 (一次选择)
结果: 所有3处都是张三
```

## 如何在Firebase中创建使用变量的剧本

### 标准模板
```json
{
  "剧本名": "你的故事名称",
  "剧本类别": "【单人】【多AI】",
  "参与AI数": 2,
  "角色网络": {
    "节点": [
      {
        "姓名": "{{角色A}}",
        "角色简介": "由{{角色A}}扮演，是一个...",
        "角色目标": "帮助玩家..."
      },
      {
        "姓名": "{{角色B}}",
        "角色简介": "由{{角色B}}扮演，是一个...",
        "角色目标": "与{{角色A}}合作..."
      }
    ]
  },
  "角色视角的故事背景": "你在{{角色A}}和{{角色B}}的陪伴下...",
  "第一个选择点": "{{角色A}}建议{{角色B}}...",
  "预置策略选项": [
    "同意{{角色A}}的想法",
    "支持{{角色B}}的建议",
    "提出自己的意见"
  ]
}
```

## 故障排除

### 问题 1: 没有显示变量选择界面
- ✅ 检查剧本是否包含 `{{角色X}}` 格式的变量
- ✅ 变量名必须是英文字母 (A-J) 或数字 (0-9)
- ✅ 格式必须严格：`{{角色A}}` 而不是 `{角色A}` 或 `{{角色A }}`

### 问题 2: 提示"请为所有角色变量分配AI角色"
- ✅ 检查是否为所有变量都做了选择
- ✅ 确认下拉菜单中有合适的AI角色可选

### 问题 3: 游戏中仍然看到 {{角色A}} 这样的文本
- ✅ 这是后端替换失败
- ✅ 检查后端日志中的替换日志
- ✅ 确认AI角色信息是否完整

## 相关文档

- 📖 [完整功能文档](CHARACTER_VARIABLES_FEATURE.md)
- 📖 [实现总结](CHARACTER_VARIABLES_IMPLEMENTATION_SUMMARY.md)
- 📖 [变更日志](CHANGELOG_CHARACTER_VARIABLES.md)

---

**就这样！🚀 现在你可以创建灵活的、参数化的剧本了！**

