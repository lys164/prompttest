# 📋 对话历史调试功能

## 功能说明

现在可以点击对话历史中的 AI 回复消息，展开查看该条消息对应的**系统提示（System Prompt）**和**用户提示（User Prompt）**，这对调试和优化提示词非常有用。

## 使用步骤

1. **进入游戏界面**
   - 开始游玩一个剧本
   - 选择角色和做出选择
   - 等待 AI 生成故事

2. **查看对话历史**
   - 游戏对话会显示在左侧的"对话历史"面板
   - 看到 AI 回复的消息时，注意右上角会显示一个绿色的 **"▶ 日志"** 按钮

3. **展开查看提示词**
   - 点击 AI 消息或点击 **"▶ 日志"** 按钮
   - 消息会展开显示：
     - **📋 System Prompt**: AI 系统提示（绿色代码块）
     - **👤 User Prompt**: 用户提示（蓝色代码块）

## 关键信息

### System Prompt 包含
- AI 角色的人设信息（姓名、年龄、国籍、性格等）
- 角色能力和超能力
- 剧本背景和故事设定
- 模型应该如何表现和响应的指导

### User Prompt 包含
- 角色当前的视角和背景
- 当前的选择点（情景描述）
- 用户刚做出的选择
- 之前的重要情节（历史上下文）

## 调试用途

✅ **调试和优化**：
- 检查模型接收到的完整提示词
- 验证变量替换是否正确
- 理解模型为什么给出特定的响应
- 识别缺失或不正确的角色信息

✅ **改进体验**：
- 通过调试面板修改系统提示
- 测试不同的提示词配置
- 观察提示词变化对故事的影响

## 技术实现

### 前端改动
- `DialogueDisplay.tsx`: 添加了展开/收起功能
- 支持点击消息展开提示词信息
- 平滑的动画过渡效果

### 后端改动
- `game.ts`: 在 AI 回复时保存 systemPrompt 和 userPrompt
- `types.ts`: 扩展 DialogueEntry 接口添加新字段
- 对话历史现在包含完整的调试信息

## 示例

```
消息：[绿色标签 "▶ 日志"]
点击后展开：

📋 System Prompt:
你是一个神秘的AI角色...
年龄：28
国籍：美国
特长：...

👤 User Prompt:
基于以下背景：
当前选择点：
用户选择了：...
历史重要情节：...
```

## 注意事项

- 提示词信息仅用于**调试目的**，在生产环境可根据需要关闭
- 过长的提示词会自动添加滚动条
- 最多显示 160px 高度的提示词（可滚动）

